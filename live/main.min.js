'use strict';var currentPlayer;window.onload=function(){Array.from(document.getElementsByClassName('js-nav')).map(function(a){a.onclick=function(){activateElement('js-nav',a.id)}}),document.getElementById('update-games').onclick=function(){getGames()},['share-app','streams-share-channel','clips-share-channel'].map(function(a){var b=document.getElementById(a);b.onclick=function(){return tweetThis.call(b)}}),getGames()};function activateElement(a,b){switch(a){case'js-nav':var c=document.getElementById(b);c.parentElement.querySelector('.js-nav.active').classList.remove('active'),c.classList.add('active'),switchSection(b);break;case'js-nav-section':var d=document.getElementById(b);d.parentElement.querySelector('.js-nav-section.active').classList.replace('active','hide'),d.classList.replace('hide','active'),activateElement('js-player',d.querySelector('.js-player').id);break;case'js-player-section':var e=document.getElementById(b);e.parentElement.querySelector('.js-player-section.active').classList.replace('active','hide'),e.classList.replace('hide','active');break;case'js-video':var f=b;f.parentElement.querySelector('.js-video.active').classList.remove('active'),f.classList.add('active'),'streams-playlist'===f.parentElement.id?activateElement('js-player','streams-player'):activateElement('js-player','clips-player');break;case'js-player':currentPlayer&&currentPlayer.pause(),currentPlayer=playVideo.call({player_id:b});break;default:throw'Unidentified type ='+a+'.';}}function switchSection(a){switch(a){case'nav-item-games':activateElement('js-nav-section','games');break;case'nav-item-streams':activateElement('js-nav-section','streams');break;case'nav-item-clips':activateElement('js-nav-section','clips');break;case'nav-item-playlist':activateElement('js-player-section','streams-playlist');break;case'nav-item-chat':activateElement('js-player-section','streams-chat');break;default:throw'No section element with '+a;}}function getGames(){var a=document.querySelector('.js-games-grid');a.innerHTML='';apiGetRequest('https://api.twitch.tv/kraken/games/top?limit=50',function(){var c=JSON.parse(this.responseText);c.top.map(function(d){a.innerHTML+='<img src="'+d.game.box.large+'" class="games-grid_card js-game-card" data-id="'+d.game.name+'">'}),Array.from(document.getElementsByClassName('js-game-card')).map(function(d){d.onclick=function(){Array.from(document.getElementsByClassName('js-nav-section')).map(function(f){return f.classList.remove('blank')}),document.getElementById('nav-item-streams').click();var e=d.getAttribute('data-id');document.querySelector('.streams-header_game').textContent=e,document.querySelector('.clips-header_game').textContent=e,getStreams.call({game:e}),getClips.call({game:e,period:'week'})}})})}function getStreams(){var a=document.getElementById('streams-playlist');a.innerHTML='';var b='https://api.twitch.tv/kraken/streams/?game='+this.game+'&limit=100&stream_type=live';apiGetRequest(b,function(){var c=JSON.parse(this.responseText);c.streams.filter(function(e){return'en'===e.channel.broadcaster_language&&'en'===e.channel.language}).slice(0,10).map(function(e){a.innerHTML+=renderPlaylistVideo.call(e,'stream')});var d=Array.from(document.getElementById('streams-playlist').getElementsByClassName('js-video'));d[0].classList.add('active'),d.map(function(e){e.onclick=function(){activateElement('js-video',e)}}),activateElement('js-player','streams-player')})}function getClips(){var a=document.getElementById('clips-playlist');a.innerHTML='';var b='https://api.twitch.tv/kraken/clips/top?game='+this.game+'&period='+this.period+'&limit=10&language=en';apiGetRequest(b,function(){var c=JSON.parse(this.responseText);c.clips.map(function(e){a.innerHTML+=renderPlaylistVideo.call(e,'clip')});var d=Array.from(document.getElementById('clips-playlist').getElementsByClassName('js-video'));d[0].classList.add('active'),d.map(function(e){e.onclick=function(){activateElement('js-video',e)}})})}function playVideo(){var a=document.getElementById(this.player_id);a.innerHTML='';var b,c;switch(this.player_id){case'streams-player':b=document.getElementById('streams-playlist').querySelector('.js-video.active'),b&&(c={channel:b.getAttribute('data-id')},document.getElementById('streams-chat').innerHTML='<iframe id="'+b.getAttribute('data-id')+'" height="100%" width="100%" frameborder="0" scrolling="yes" src="https://www.twitch.tv/'+b.getAttribute('data-id')+'/chat"></iframe>');break;case'clips-player':b=document.getElementById('clips-playlist').querySelector('.js-video.active'),b&&(c={video:b.getAttribute('data-id')});break;default:throw'Must specify type of video (stream or clip) for playVideo function.';}if(c)return renderCurrentVideoInfo(this.player_id,b),a=new Twitch.Player(this.player_id,c),a.pause(),a.play(),a.setVolume(0.5),a}function renderPlaylistVideo(a){if('stream'===a)return'\n    <div class="playlist-video js-video"\n         data-id='+this.channel.name+'\n         data-display-id='+this.channel.display_name+'\n         data-url='+this.channel.url+'\n         data-title="'+this.channel.status+'"\n         data-followers='+this.channel.followers+'\n         data-logo='+this.channel.logo+' >\n\n      <img src='+this.preview.large+' alt="" class="playlist-video_thumbnail">\n      <div class="playlist-video_content">\n        <p class="playlist-video-title">'+this.channel.status+'</p>\n        <div class="playlist-video-meta">\n          <span class="playlist-video-channel">'+this.channel.display_name+'</span>\n          <span class="playlist-video-viewers">'+this.viewers+' Viewers</span>\n        </div>\n      </div>\n    </div>\n    ';if('clip'===a){var b=this.vod;return b=void 0===b||null===b?'':b.id,'\n    <div class="playlist-video js-video"\n         data-id='+b+'\n         data-display-id='+this.broadcaster.display_name+'\n         data-url='+this.broadcaster.channel_url+'\n         data-title="'+this.title+'"\n         data-logo='+this.broadcaster.logo+' >\n\n      <img src='+this.thumbnails.medium+' alt="" class="playlist-video_thumbnail">\n      <div class="playlist-video_content">\n        <p class="playlist-video-title">'+this.title+'</p>\n        <div class="playlist-video-meta">\n          <span class="playlist-video-channel">'+this.broadcaster.display_name+'</span>\n          <span class="playlist-video-viewers">'+this.views+' Views</span>\n        </div>\n      </div>\n    </div>\n    '}throw'Type "streams" or "clips" must be specified to render playlist videos.'}function renderCurrentVideoInfo(a,b){var c=document.getElementById(a).nextElementSibling;c.querySelector('.player-title').textContent=b.getAttribute('data-title'),c.querySelector('.player-channel-icon').firstElementChild.setAttribute('src',b.getAttribute('data-logo')),c.querySelector('.player-channel-name').textContent=b.getAttribute('data-display-id'),c.querySelectorAll('.btn-link')[0].setAttribute('data-channel-name',b.getAttribute('data-display-id')),c.querySelectorAll('.btn-link')[0].setAttribute('data-channel-url',b.getAttribute('data-url')),c.querySelectorAll('.btn-link')[1].setAttribute('href',b.getAttribute('data-url')),'streams-player'===a&&(c.querySelectorAll('.btn_text')[2].textContent=formatPersonCount(b.getAttribute('data-followers')))}function formatPersonCount(a){var b=Number.parseFloat(a),c=function(d,e){return d=+d,e=+e,d=d.toString().split('e'),d=Math.round(+(d[0]+'e'+(d[1]?+d[1]-e:-e))),d=d.toString().split('e'),+(d[0]+'e'+(d[1]?+d[1]+e:e))};return 1e3>b?b:1e3<=b&&1e6>b?c(b/1e3,-1).toString()+'K':c(b/1e6,-1).toString()+'M'}function tweetThis(){switch(this.id){case'streams-share-channel':case'clips-share-channel':var b=this.getAttribute('data-channel-url'),c=this.getAttribute('data-channel-name').toUpperCase();postApiRequest.call({contentType:'application/json',payload:{longUrl:b}},'https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDlaUZKR_p0xJTIZ1aQt5uH9oPYDzGn4Uc',function(){var g=JSON.parse(this.responseText);window.open('http://twitter.com/share?url='+encodeURIComponent(g.id)+'&text='+encodeURIComponent('Give '+c+' a try on Twitch. Quite Entertaining!'),'','left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0')});break;case'share-app':var d=this.getAttribute('data-app-url'),e=this.getAttribute('data-app-name');window.open('http://twitter.com/share?url='+encodeURIComponent(d)+'&text='+encodeURIComponent('Check out this '+e+' for  (mostly) English-only Top Live Streams and Clips. Great for discovering some new streamers of top games on Twitch.'),'','left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0');break;default:console.log('Wait! what?! which TWEET button did you click!');}}function xhrSuccess(){4===this.readyState&&(200===this.status?this.callback.apply(this):console.error(this.statusText))}function xhrError(){console.error(this.statusText)}function apiGetRequest(a,b){var c=new XMLHttpRequest;c.callback=b,c.onload=xhrSuccess,c.onerror=xhrError,c.open('GET',a,!0),c.setRequestHeader('Accept','application/vnd.twitchtv.v5+json'),c.setRequestHeader('Client-ID','quj90wdz8sgsc3o5rfq1evnrjomzfs'),c.send(null)}function postApiRequest(a,b){var c=new XMLHttpRequest;c.callback=b,c.arguments=Array.prototype.slice.call(arguments,2),c.onload=xhrSuccess,c.onerror=xhrError,c.open('POST',a,!0),this.contentType&&c.setRequestHeader('Content-Type',this.contentType),this.accept&&c.setRequestHeader('Accept',this.accept),c.send(JSON.stringify(this.payload))}
